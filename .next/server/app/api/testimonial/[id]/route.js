(()=>{var e={};e.id=3007,e.ids=[3007],e.modules={3040:(e,t,r)=>{"use strict";r.d(t,{q:()=>o});var a=r(56037),n=r.n(a);let i=process.env.MONGODB_URI;async function o(){n().connections[0].readyState||await n().connect(i)}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12269:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},12412:e=>{"use strict";e.exports=require("assert")},19854:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var n=r(12269);Object.keys(n).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(a,e))&&(e in t&&t[e]===n[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}}))});var i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=o(t);if(r&&r.has(e))return r.get(e);var a={__proto__:null},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&({}).hasOwnProperty.call(e,i)){var s=n?Object.getOwnPropertyDescriptor(e,i):null;s&&(s.get||s.set)?Object.defineProperty(a,i,s):a[i]=e[i]}return a.default=e,r&&r.set(e,a),a}(r(35426));function o(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(o=function(e){return e?r:t})(e)}Object.keys(i).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(a,e))&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))})},26214:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var a=r(56037);let n=new a.Schema({name:{type:String,required:!0,trim:!0},role:{type:String,required:!0,trim:!0},photo:{type:String,required:!0},quote:{type:String,required:!0},rating:{type:Number,required:!0,min:0,max:5}},{timestamps:!0}),i=a.models.Testimonial||(0,a.model)("Testimonial",n)},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31860:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>b,routeModule:()=>h,serverHooks:()=>x,workAsyncStorage:()=>O,workUnitAsyncStorage:()=>j});var a={};r.r(a),r.d(a,{DELETE:()=>w,PUT:()=>v});var n=r(96559),i=r(48088),o=r(37719),s=r(3040),u=r(26214),l=r(32190),p=r(19854),d=r(41098),c=r(79748),f=r.n(c),m=r(33873),y=r.n(m),g=r(84113);async function v(e){try{let t=await (0,p.getServerSession)(d.N);if(!t||"admin"!==t.user.role)return l.NextResponse.json({error:"Unauthorized"},{status:401});let r=new URL(e.url).pathname.split("/").pop(),a=await e.formData(),n=a.get("name")?.toString()||"",i=a.get("role")?.toString()||"",o=a.get("quote")?.toString()||"",c=parseFloat(a.get("rating")?.toString()||"0"),m=a.get("photo");await (0,s.q)();let v=await u.A.findById(r);if(!v)return l.NextResponse.json({error:"Testimonial not found"},{status:404});let w=v.photo;if(m&&m.size>0){let e=y().join(process.cwd(),"public",w);try{await f().unlink(e)}catch(e){console.warn("Failed to delete old image (may not exist):",e)}let t=Buffer.from(await m.arrayBuffer()),r=`${(0,g.A)()}-${m.name}`;w=y().join("/uploads/testimonials",r).replace(/\\/g,"/");let a=y().join(process.cwd(),"public",w);await f().writeFile(a,t)}return v.name=n,v.role=i,v.quote=o,v.rating=c,v.photo=w,await v.save(),l.NextResponse.json({message:"Testimonial updated",testimonial:v})}catch(e){return console.error("[TESTIMONIAL_PUT_ERROR]",e),l.NextResponse.json({error:"Failed to update testimonial"},{status:500})}}async function w(e){try{let t=await (0,p.getServerSession)(d.N);if(!t||"admin"!==t.user.role)return l.NextResponse.json({error:"Unauthorized"},{status:401});let r=new URL(e.url).pathname.split("/").pop();await (0,s.q)();let a=await u.A.findById(r);if(!a)return l.NextResponse.json({error:"Testimonial not found"},{status:404});let n=y().join(process.cwd(),"public",a.photo);try{await f().unlink(n)}catch(e){console.warn("Failed to delete testimonial image (may not exist):",e)}return await a.deleteOne(),l.NextResponse.json({message:"Testimonial deleted successfully"})}catch(e){return console.error("[TESTIMONIAL_DELETE_ERROR]",e),l.NextResponse.json({error:"Failed to delete testimonial"},{status:500})}}let h=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/testimonial/[id]/route",pathname:"/api/testimonial/[id]",filename:"route",bundlePath:"app/api/testimonial/[id]/route"},resolvedPagePath:"C:\\Users\\DAY\\OneDrive\\Desktop\\Neighborhood\\neighborhood-empowerment-funds\\app\\api\\testimonial\\[id]\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:O,workUnitAsyncStorage:j,serverHooks:x}=h;function b(){return(0,o.patchFetch)({workAsyncStorage:O,workUnitAsyncStorage:j})}},32170:(e,t,r)=>{"use strict";r.d(t,{K:()=>o});var a=r(56037),n=r.n(a);let i=new(n()).Schema({name:{type:String,required:!0},email:{type:String,unique:!0,required:!0},hashedPassword:{type:String,default:null},oauthProvider:{type:String,default:null},oauthId:{type:String,default:null},role:{type:String,enum:["user","admin"],default:"user"},avatar:{type:String,default:null}},{timestamps:!0}),o=n().models.User||n().model("User",i)},33873:e=>{"use strict";e.exports=require("path")},41098:(e,t,r)=>{"use strict";r.d(t,{N:()=>u});var a=r(36344),n=r(13581),i=r(85663),o=r(3040),s=r(32170);let u={providers:[(0,n.A)({name:"Credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e.password)return null;await (0,o.q)();let t=await s.K.findOne({email:e.email});return t&&t.hashedPassword&&await i.Ay.compare(e.password,t.hashedPassword)?{id:t._id.toString(),name:t.name,email:t.email,role:t.role,avatar:t.avatar}:null}}),(0,a.A)({clientId:process.env.GOOGLE_CLIENT_ID??"",clientSecret:process.env.GOOGLE_CLIENT_SECRET??""})],pages:{signIn:"/signin",signOut:"/signout"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET,callbacks:{async signIn({user:e,account:t,profile:r}){if(t?.provider==="google"){await (0,o.q)();let t=await s.K.findOne({email:e.email});t||(t=await s.K.create({name:e.name,email:e.email,hashedPassword:null,oauthProvider:"google",oauthId:r?.sub||void 0,role:"user",avatar:e.image??void 0})),e.id=t._id.toString(),e.role=t.role,e.avatar=t.avatar??void 0}return!0},jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.email=t.email??void 0,e.name=t.name??void 0,e.role=t.role??void 0,e.avatar=t.avatar??void 0),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id,e.user.email=t.email??void 0,e.user.name=t.name??void 0,e.user.role=t.role??void 0,e.user.avatar=t.avatar??void 0),e)}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56037:e=>{"use strict";e.exports=require("mongoose")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74075:e=>{"use strict";e.exports=require("zlib")},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return u}});let a=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var a={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var s=i?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(a,o,s):a[o]=e[o]}return a.default=e,r&&r.set(e,a),a}(r(61120));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}let i={current:null},o="function"==typeof a.cache?a.cache:e=>e,s=console.warn;function u(e){return function(...t){s(e(...t))}}o(e=>{try{s(i.current)}finally{i.current=null}})},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79748:e=>{"use strict";e.exports=require("fs/promises")},81630:e=>{"use strict";e.exports=require("http")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[7719,580,5663,589],()=>r(31860));module.exports=a})();