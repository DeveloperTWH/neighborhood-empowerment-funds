(()=>{var e={};e.id=1438,e.ids=[1438],e.modules={3040:(e,t,r)=>{"use strict";r.d(t,{q:()=>n});var s=r(56037),a=r.n(s);let i=process.env.MONGODB_URI;async function n(){a().connections[0].readyState||await a().connect(i)}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},11723:e=>{"use strict";e.exports=require("querystring")},12269:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0})},12412:e=>{"use strict";e.exports=require("assert")},19854:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={};Object.defineProperty(t,"default",{enumerable:!0,get:function(){return i.default}});var a=r(12269);Object.keys(a).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(s,e))&&(e in t&&t[e]===a[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}}))});var i=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=n(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in e)if("default"!==i&&({}).hasOwnProperty.call(e,i)){var o=a?Object.getOwnPropertyDescriptor(e,i):null;o&&(o.get||o.set)?Object.defineProperty(s,i,o):s[i]=e[i]}return s.default=e,r&&r.set(e,s),s}(r(35426));function n(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(n=function(e){return e?r:t})(e)}Object.keys(i).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(s,e))&&(e in t&&t[e]===i[e]||Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}}))})},28354:e=>{"use strict";e.exports=require("util")},29021:e=>{"use strict";e.exports=require("fs")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},32170:(e,t,r)=>{"use strict";r.d(t,{K:()=>n});var s=r(56037),a=r.n(s);let i=new(a()).Schema({name:{type:String,required:!0},email:{type:String,unique:!0,required:!0},hashedPassword:{type:String,default:null},oauthProvider:{type:String,default:null},oauthId:{type:String,default:null},role:{type:String,enum:["user","admin"],default:"user"},avatar:{type:String,default:null}},{timestamps:!0}),n=a().models.User||a().model("User",i)},33873:e=>{"use strict";e.exports=require("path")},41098:(e,t,r)=>{"use strict";r.d(t,{N:()=>u});var s=r(36344),a=r(13581),i=r(85663),n=r(3040),o=r(32170);let u={providers:[(0,a.A)({name:"Credentials",credentials:{email:{label:"Email",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e.password)return null;await (0,n.q)();let t=await o.K.findOne({email:e.email});return t&&t.hashedPassword&&await i.Ay.compare(e.password,t.hashedPassword)?{id:t._id.toString(),name:t.name,email:t.email,role:t.role,avatar:t.avatar}:null}}),(0,s.A)({clientId:process.env.GOOGLE_CLIENT_ID??"",clientSecret:process.env.GOOGLE_CLIENT_SECRET??""})],pages:{signIn:"/signin",signOut:"/signout"},session:{strategy:"jwt"},secret:process.env.NEXTAUTH_SECRET,callbacks:{async signIn({user:e,account:t,profile:r}){if(t?.provider==="google"){await (0,n.q)();let t=await o.K.findOne({email:e.email});t||(t=await o.K.create({name:e.name,email:e.email,hashedPassword:null,oauthProvider:"google",oauthId:r?.sub||void 0,role:"user",avatar:e.image??void 0})),e.id=t._id.toString(),e.role=t.role,e.avatar=t.avatar??void 0}return!0},jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.email=t.email??void 0,e.name=t.name??void 0,e.role=t.role??void 0,e.avatar=t.avatar??void 0),e),session:async({session:e,token:t})=>(e.user&&(e.user.id=t.id,e.user.email=t.email??void 0,e.user.name=t.name??void 0,e.user.role=t.role??void 0,e.user.avatar=t.avatar??void 0),e)}}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},56037:e=>{"use strict";e.exports=require("mongoose")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71710:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>P,routeModule:()=>O,serverHooks:()=>S,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>q});var s={};r.r(s),r.d(s,{GET:()=>h,POST:()=>x,config:()=>j});var a=r(96559),i=r(48088),n=r(37719),o=r(56037),u=r.n(o);let l=new(u()).Schema({title:{type:String,required:!0},image:{type:String,required:!0},description:{type:[String],required:!0},features:{type:[String],required:!0}},{timestamps:!0}),c=u().models.Service||u().model("Service",l);var p=r(3040),d=r(32190),f=r(19854),g=r(41098),m=r(33873),v=r.n(m),y=r(79748),w=r(29021);async function h(){try{let e=await (0,f.getServerSession)(g.N);if(!e||"admin"!==e.user.role)return d.NextResponse.json({message:"Unauthorized"},{status:401});await (0,p.q)();let t=await c.find().sort({_id:-1});return d.NextResponse.json(t)}catch(e){return d.NextResponse.json({message:"Failed to fetch services",error:e},{status:500})}}let j={api:{bodyParser:!1}};async function x(e){try{let t=await (0,f.getServerSession)(g.N);if(!t||"admin"!==t.user.role)return console.log("nan not an admin"),d.NextResponse.json({message:"Unauthorized"},{status:401});let r=await e.formData(),s=r.get("image"),a=r.get("title")?.toString()||"",i=r.getAll("description"),n=r.getAll("features");if(!s||!a.trim()||0===i.length||0===n.length)return d.NextResponse.json({message:"Missing required fields"},{status:400});if(!["image/jpeg","image/png","image/webp"].includes(s.type))return d.NextResponse.json({message:"Invalid image type"},{status:400});let o=Buffer.from(await s.arrayBuffer()),u=v().join(process.cwd(),"public/uploads/service");(0,w.existsSync)(u)||(0,w.mkdirSync)(u,{recursive:!0});let l=`${Date.now()}-${s.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9.\-_]/g,"")}`,m=v().join(u,l);await (0,y.writeFile)(m,o);let h=`/uploads/service/${l}`;await (0,p.q)();let j=await c.create({title:a.trim(),image:h,description:i.map(e=>e.toString().trim()),features:n.map(e=>e.toString().trim())});return d.NextResponse.json(j,{status:201})}catch(e){return console.error("Upload service error:",e),d.NextResponse.json({message:"Failed to create service",error:e},{status:500})}}let O=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/services/route",pathname:"/api/services",filename:"route",bundlePath:"app/api/services/route"},resolvedPagePath:"C:\\Users\\DAY\\OneDrive\\Desktop\\Neighborhood\\neighborhood-empowerment-funds\\app\\api\\services\\route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:b,workUnitAsyncStorage:q,serverHooks:S}=O;function P(){return(0,n.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:q})}},74075:e=>{"use strict";e.exports=require("zlib")},76926:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createDedupedByCallsiteServerErrorLoggerDev",{enumerable:!0,get:function(){return u}});let s=function(e,t){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var r=a(t);if(r&&r.has(e))return r.get(e);var s={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&Object.prototype.hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(s,n,o):s[n]=e[n]}return s.default=e,r&&r.set(e,s),s}(r(61120));function a(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,r=new WeakMap;return(a=function(e){return e?r:t})(e)}let i={current:null},n="function"==typeof s.cache?s.cache:e=>e,o=console.warn;function u(e){return function(...t){o(e(...t))}}n(e=>{try{o(i.current)}finally{i.current=null}})},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79551:e=>{"use strict";e.exports=require("url")},79748:e=>{"use strict";e.exports=require("fs/promises")},81630:e=>{"use strict";e.exports=require("http")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,580,5663,589],()=>r(71710));module.exports=s})();