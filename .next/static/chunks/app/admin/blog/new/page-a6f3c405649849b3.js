(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5174],{193:(e,t,a)=>{Promise.resolve().then(a.bind(a,6191))},612:()=>{},6191:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var l=a(5155),s=a(5695),i=a(2108),o=a(2115),n=a(5109),r=a(8292),c=a(1891),d=a(3568),u=a(9727),g=a(9144),m=a(2705),h=a(5968),p=a(9140);function b(){let e=(0,s.useRouter)(),{data:t}=(0,i.useSession)(),[a,b]=(0,o.useState)(""),[x,y]=(0,o.useState)(null),[f,v]=(0,o.useState)([]),[j,N]=(0,o.useState)([]),[w,A]=(0,o.useState)(0),[C,k]=(0,o.useState)(!1),[S,_]=(0,o.useState)(!1),E=(0,n.hG)({extensions:[r.A,c.Ay],content:""});(0,o.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/category"),t=await e.json();Array.isArray(t)?v(t):(v([]),d.Ay.error("No categories found"))}catch(e){console.error(e),d.Ay.error("Failed to load categories")}})()},[]),(0,o.useEffect)(()=>{let e=e=>{e.target.closest(".relative")||k(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);let I=async e=>{try{let t=new FormData;t.append("coverImage",e);let a=await fetch("/api/blog/upload",{method:"POST",body:t});if(!a.ok)throw Error("Image upload failed");let l=await a.json();null==E||E.chain().focus().setImage({src:l.url}).run()}catch(e){console.error(e),d.Ay.error("Failed to upload inline image")}},B=async l=>{l.preventDefault();let s=null==E?void 0:E.getHTML();if(!j.length)return void d.Ay.error("Please select at least one category");try{var i,o;let l="";if(x){let e=new FormData;e.append("coverImage",x);let t=await fetch("/api/blog/upload",{method:"POST",body:e});if(!t.ok)throw Error("Cover image upload failed");l=(await t.json()).url}if(!(await fetch("/api/blog/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:a,author:(null==t||null==(i=t.user)?void 0:i.name)||"Anonymous",coverImage:l,content:s,category:j,readTime:w,featured:S})})).ok)throw Error("Blog creation failed");d.Ay.success("Blog post submitted!"),console.log({title:a,author:(null==t||null==(o=t.user)?void 0:o.name)||"Anonymous",coverImage:l,content:s,category:j,readTime:w}),e.push("/admin/blog")}catch(e){console.error(e),d.Ay.error("Blog creation failed")}};return(0,l.jsx)("div",{className:"min-h-screen px-4 py-8 bg-gray-100 flex justify-center",children:(0,l.jsxs)("form",{onSubmit:B,className:"bg-white shadow-lg rounded-xl p-8 w-full max-w-3xl space-y-6",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"Add New Blog Post"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Title"}),(0,l.jsx)("input",{type:"text",value:a,onChange:e=>b(e.target.value),required:!0,className:"w-full px-4 py-2 border rounded-lg bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-400"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Cover Image"}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return y((null==(t=e.target.files)?void 0:t[0])||null)},className:"w-full px-4 py-2 border rounded-lg bg-gray-50"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Categories"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("button",{type:"button",className:"w-full text-left px-4 py-2 border rounded-lg bg-gray-50",onClick:()=>k(!C),children:j.length>0?f.filter(e=>j.includes(e._id)).map(e=>e.name).join(", "):"Select categories"}),C&&(0,l.jsx)("div",{className:"absolute z-10 mt-2 w-full bg-white border rounded-lg shadow-lg max-h-48 overflow-auto",children:f.map(e=>(0,l.jsxs)("label",{className:"flex items-center px-4 py-2 hover:bg-gray-100",children:[(0,l.jsx)("input",{type:"checkbox",checked:j.includes(e._id),onChange:()=>{N(t=>t.includes(e._id)?t.filter(t=>t!==e._id):[...t,e._id])},className:"mr-2"}),e.name]},e._id))})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Estimated Read Time (minutes)"}),(0,l.jsx)("input",{type:"number",value:w,onChange:e=>A(Number(e.target.value)),min:1,required:!0,className:"w-full px-4 py-2 border rounded-lg bg-gray-50"})]}),E&&(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 border p-3 rounded-lg bg-gray-50",children:[(0,l.jsx)("button",{type:"button",title:"Bold",onClick:()=>E.chain().focus().toggleBold().run(),className:"toolbar-btn ".concat(E.isActive("bold")?"active":""),children:(0,l.jsx)(u.A,{size:16})}),(0,l.jsx)("button",{type:"button",title:"Italic",onClick:()=>E.chain().focus().toggleItalic().run(),className:"toolbar-btn ".concat(E.isActive("italic")?"active":""),children:(0,l.jsx)(g.A,{size:16})}),(0,l.jsx)("button",{type:"button",title:"Heading",onClick:()=>E.chain().focus().toggleHeading({level:2}).run(),className:"toolbar-btn ".concat(E.isActive("heading",{level:2})?"active":""),children:(0,l.jsx)(m.A,{size:16})}),(0,l.jsx)("button",{type:"button",title:"Bullet List",onClick:()=>E.chain().focus().toggleBulletList().run(),className:"toolbar-btn ".concat(E.isActive("bulletList")?"active":""),children:(0,l.jsx)(h.A,{size:16})}),(0,l.jsx)("button",{type:"button",title:"Numbered List",onClick:()=>E.chain().focus().toggleOrderedList().run(),className:"toolbar-btn ".concat(E.isActive("orderedList")?"active":""),children:(0,l.jsx)(p.A,{size:16})})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Insert Image into Blog Content"}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&I(a)},className:"w-full px-4 py-2 border rounded-lg bg-gray-50"})]}),(0,l.jsx)("div",{className:"border rounded-lg bg-white min-h-[200px] p-4",children:(0,l.jsx)(n.$Z,{editor:E})}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Featured Post"}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"radio",name:"featured",value:"yes",checked:!0===S,onChange:()=>_(!0),className:"accent-indigo-600"}),"Yes"]}),(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"radio",name:"featured",value:"no",checked:!1===S,onChange:()=>_(!1),className:"accent-indigo-600"}),"No"]})]})]}),(0,l.jsx)("button",{type:"submit",className:"w-full py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700",children:"Submit Blog Post"})]})})}a(612)}},e=>{var t=t=>e(e.s=t);e.O(0,[9789,5004,277,2108,8625,6745,8441,1684,7358],()=>t(193)),_N_E=e.O()}]);