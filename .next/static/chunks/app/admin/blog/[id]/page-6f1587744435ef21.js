(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4235],{2978:(e,t,a)=>{Promise.resolve().then(a.bind(a,3736))},3736:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>b});var l=a(5155),s=a(5695),r=a(2108),i=a(2115),n=a(5109),o=a(8292),c=a(1891),d=a(3568),u=a(9727),g=a(9144),m=a(2705),p=a(5968),h=a(9140);function b(){let{id:e}=(0,s.useParams)(),t=(0,s.useRouter)(),{data:a}=(0,r.useSession)(),[b,y]=(0,i.useState)(""),[x,f]=(0,i.useState)(null),[v,j]=(0,i.useState)(""),[N,w]=(0,i.useState)([]),[C,A]=(0,i.useState)([]),[k,S]=(0,i.useState)(0),[E,_]=(0,i.useState)(!1),[I,P]=(0,i.useState)(!1),T=(0,i.useRef)([]),L=(0,i.useRef)(!1),B=(0,n.hG)({extensions:[o.A,c.Ay],content:""});(0,i.useEffect)(()=>()=>{!L.current&&T.current.length>0&&fetch("/api/blog/cleanup-inline-images",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({images:T.current})})},[]),(0,i.useEffect)(()=>{(async()=>{try{let[t,a]=await Promise.all([fetch("/api/blog/".concat(e)),fetch("/api/category")]),l=await t.json(),s=await a.json();y(l.title),j(l.coverImage);let r=Array.isArray(l.category)?l.category.map(e=>"string"==typeof e?e:e._id):[];A(r),S(l.readTime),P(l.featured),null==B||B.commands.setContent(l.content||""),Array.isArray(s)&&w(s)}catch(e){console.error("Failed to load blog or categories",e),d.Ay.error("Failed to load blog data")}})()},[B,e]),(0,i.useEffect)(()=>{let e=e=>{e.target.closest(".relative")||_(!1)};return document.addEventListener("click",e),()=>document.removeEventListener("click",e)},[]);let O=async e=>{try{let t=new FormData;t.append("coverImage",e);let a=await fetch("/api/blog/upload",{method:"POST",body:t});if(!a.ok)throw Error("Image upload failed");let l=await a.json();T.current.push(l.url),null==B||B.chain().focus().setImage({src:l.url}).run()}catch(e){console.error(e),d.Ay.error("Failed to upload inline image")}},F=async l=>{l.preventDefault();let s=null==B?void 0:B.getHTML();if(!C.length)return void d.Ay.error("Please select at least one category");try{var r;let l=v;if(x){let e=new FormData;e.append("coverImage",x);let t=await fetch("/api/blog/upload",{method:"POST",body:e});if(!t.ok)throw Error("Cover upload failed");l=(await t.json()).url}if(!(await fetch("/api/blog/update/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:b,author:(null==a||null==(r=a.user)?void 0:r.name)||"Anonymous",coverImage:l,content:s,category:C,readTime:k,featured:I})})).ok)throw Error("Update failed");L.current=!0,d.Ay.success("Blog updated successfully"),t.push("/admin/blog")}catch(e){console.error(e),d.Ay.error("Failed to update blog")}};return(0,l.jsx)("div",{className:"min-h-screen px-4 py-8 bg-gray-100 flex justify-center",children:(0,l.jsxs)("form",{onSubmit:F,className:"bg-white shadow-lg rounded-xl p-8 w-full max-w-3xl space-y-6",children:[(0,l.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"Edit Blog Post"}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Title"}),(0,l.jsx)("input",{type:"text",value:b,onChange:e=>y(e.target.value),required:!0,className:"w-full px-4 py-2 border rounded-lg bg-gray-50 focus:ring-indigo-400"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Cover Image"}),v&&(0,l.jsx)("img",{src:v,alt:"Current Cover",className:"w-full h-40 object-cover rounded mb-2"}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;return f((null==(t=e.target.files)?void 0:t[0])||null)},className:"w-full px-4 py-2 border rounded-lg bg-gray-50"})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Categories"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("button",{type:"button",className:"w-full text-left px-4 py-2 border rounded-lg bg-gray-50",onClick:()=>_(!E),children:C.length>0?N.filter(e=>C.includes(e._id)).map(e=>e.name).join(", "):"Select categories"}),E&&(0,l.jsx)("div",{className:"absolute z-10 mt-2 w-full bg-white border rounded-lg shadow-lg max-h-48 overflow-auto",children:N.map(e=>(0,l.jsxs)("label",{className:"flex items-center px-4 py-2 hover:bg-gray-100",children:[(0,l.jsx)("input",{type:"checkbox",checked:C.includes(e._id),onChange:()=>{A(t=>t.includes(e._id)?t.filter(t=>t!==e._id):[...t,e._id])},className:"mr-2"}),e.name]},e._id))})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Estimated Read Time (minutes)"}),(0,l.jsx)("input",{type:"number",value:k,onChange:e=>S(Number(e.target.value)),min:1,required:!0,className:"w-full px-4 py-2 border rounded-lg bg-gray-50"})]}),B&&(0,l.jsxs)("div",{className:"flex flex-wrap gap-2 border p-3 rounded-lg bg-gray-50",children:[(0,l.jsx)("button",{type:"button",title:"Bold",onClick:()=>B.chain().focus().toggleBold().run(),className:"toolbar-btn ".concat(B.isActive("bold")?"active":""),children:(0,l.jsx)(u.A,{size:16})}),(0,l.jsx)("button",{type:"button",title:"Italic",onClick:()=>B.chain().focus().toggleItalic().run(),className:"toolbar-btn ".concat(B.isActive("italic")?"active":""),children:(0,l.jsx)(g.A,{size:16})}),(0,l.jsx)("button",{type:"button",title:"Heading",onClick:()=>B.chain().focus().toggleHeading({level:2}).run(),className:"toolbar-btn ".concat(B.isActive("heading",{level:2})?"active":""),children:(0,l.jsx)(m.A,{size:16})}),(0,l.jsx)("button",{type:"button",title:"Bullet List",onClick:()=>B.chain().focus().toggleBulletList().run(),className:"toolbar-btn ".concat(B.isActive("bulletList")?"active":""),children:(0,l.jsx)(p.A,{size:16})}),(0,l.jsx)("button",{type:"button",title:"Numbered List",onClick:()=>B.chain().focus().toggleOrderedList().run(),className:"toolbar-btn ".concat(B.isActive("orderedList")?"active":""),children:(0,l.jsx)(h.A,{size:16})})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Insert Image into Blog Content"}),(0,l.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&O(a)},className:"w-full px-4 py-2 border rounded-lg bg-gray-50"})]}),(0,l.jsx)("div",{className:"border rounded-lg bg-white min-h-[200px] p-4",children:(0,l.jsx)(n.$Z,{editor:B})}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"font-medium text-gray-700",children:"Featured Post"}),(0,l.jsxs)("div",{className:"flex gap-4",children:[(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"radio",name:"featured",value:"yes",checked:!0===I,onChange:()=>P(!0),className:"accent-indigo-600"}),"Yes"]}),(0,l.jsxs)("label",{className:"flex items-center gap-2",children:[(0,l.jsx)("input",{type:"radio",name:"featured",value:"no",checked:!1===I,onChange:()=>P(!1),className:"accent-indigo-600"}),"No"]})]})]}),(0,l.jsx)("button",{type:"submit",className:"w-full py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700",children:"Update Blog Post"})]})})}a(7003)},7003:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[1514,5004,277,2108,3568,6745,8441,1684,7358],()=>t(2978)),_N_E=e.O()}]);