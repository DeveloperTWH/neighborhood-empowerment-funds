(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[399],{1057:(e,a,l)=>{Promise.resolve().then(l.bind(l,6916))},6916:(e,a,l)=>{"use strict";l.r(a),l.d(a,{default:()=>s});var t=l(5155),n=l(2108),r=l(2115);function s(){var e,a;let{data:l}=(0,n.useSession)(),s=null!=(a=null==l||null==(e=l.user)?void 0:e.id)?a:null,[i,o]=(0,r.useState)({name:"",email:"",phone:"",avatarUrl:""}),[m,d]=(0,r.useState)({name:"",email:"",phone:""}),[u,c]=(0,r.useState)(null),[h,p]=(0,r.useState)(null),[f,x]=(0,r.useState)(!1),[b,v]=(0,r.useState)(!1),[g,j]=(0,r.useState)(!0);(0,r.useEffect)(()=>{s&&fetch("/api/users/".concat(s)).then(e=>e.json()).then(e=>{o({name:e.name||"",email:e.email||"",phone:e.phone||"",avatarUrl:e.avatar||""}),d({name:e.name||"",email:e.email||"",phone:e.phone||""}),x(!1),c(null),p(null)}).catch(e=>{console.error("Failed to fetch user data:",e)}).finally(()=>{j(!1)})},[s]),(0,r.useEffect)(()=>{v(m.name!==i.name||m.email!==i.email||m.phone!==i.phone||!!u||f)},[m,u,i,f]);let w=e=>{d({...m,[e.target.name]:e.target.value})},y=()=>{c(null),p(null),x(!0)},N=async e=>{if(e.preventDefault(),!b)return;let a=new FormData;a.append("name",m.name),a.append("email",m.email),a.append("phone",m.phone||""),a.append("removeAvatar",f.toString()),u&&a.append("avatar",u);try{let e=await fetch("/api/users/".concat(s),{method:"PUT",body:a});if(!e.ok)throw Error("Failed to update profile");let l=await e.json();o({name:l.name||"",email:l.email||"",phone:l.phone||"",avatarUrl:l.avatar||""}),c(null),p(null),x(!1),v(!1),alert("Profile updated! You will be signed out."),await (0,n.signOut)({callbackUrl:"/signin"})}catch(e){console.error(e),alert("Error updating profile.")}};return g?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-white",children:(0,t.jsx)("div",{className:"loader"})}):(0,t.jsxs)("div",{className:"max-w-3xl mx-auto p-6 bg-white rounded-lg shadow-md mt-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold mb-6",children:"Your Profile"}),(0,t.jsxs)("div",{className:"flex items-center gap-6 mb-8",children:[(()=>{var e,a;if(f){let e=(null==(a=i.name)?void 0:a.charAt(0).toUpperCase())||"U";return(0,t.jsx)("div",{className:"w-24 h-24 flex items-center justify-center bg-yellow-500 text-white text-2xl font-bold rounded-full",children:e})}let l=h||i.avatarUrl;if(l)return(0,t.jsxs)("div",{className:"relative group",children:[(0,t.jsx)("img",{src:l,alt:"Avatar",className:"w-24 h-24 rounded-full object-cover border-2 border-blue-600"}),(0,t.jsx)("button",{type:"button",onClick:y,className:"absolute -top-2 -right-2 bg-red-600 text-white text-xs px-2 py-0.5 rounded-full shadow hover:bg-red-700","aria-label":"Remove avatar",children:"âœ•"})]});let n=(null==(e=i.name)?void 0:e.charAt(0).toUpperCase())||"U";return(0,t.jsx)("div",{className:"w-24 h-24 flex items-center justify-center bg-yellow-500 text-white text-2xl font-bold rounded-full",children:n})})(),(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-medium",children:i.name}),(0,t.jsx)("p",{className:"text-gray-600",children:i.email})]})]}),(0,t.jsxs)("form",{onSubmit:N,className:"space-y-4 max-w-md",encType:"multipart/form-data",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"avatar",className:"block font-medium mb-1",children:"Profile Image"}),(0,t.jsx)("input",{type:"file",id:"avatar",name:"avatar",accept:"image/*",onChange:e=>{if(e.target.files&&e.target.files[0]){let a=e.target.files[0];c(a),p(URL.createObjectURL(a)),x(!1)}},className:"w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"name",className:"block font-medium mb-1",children:"Name"}),(0,t.jsx)("input",{type:"text",id:"name",name:"name",value:m.name,onChange:w,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"email",className:"block font-medium mb-1",children:"Email"}),(0,t.jsx)("input",{type:"email",id:"email",name:"email",value:m.email,onChange:w,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"phone",className:"block font-medium mb-1",children:"Phone Number"}),(0,t.jsx)("input",{type:"text",id:"phone",name:"phone",value:m.phone||"",onChange:w,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsx)("button",{type:"submit",className:"px-4 py-2 rounded-md transition font-medium ".concat(b?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-600 cursor-not-allowed"),disabled:!b,children:"Save Changes"})]})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[2108,8441,1684,7358],()=>a(1057)),_N_E=e.O()}]);